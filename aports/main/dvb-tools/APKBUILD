# Contributor: Duncan Guthrie <dguthrie@posteo.net>
# Maintainer: Duncan Guthrie <dguthrie@posteo.net>
pkgname=dvb-tools
_pkgname=v4l-utils
pkgver=1.14.2
pkgrel=0
pkgdesc="Collection of command line DVB utilities"
url="http://freshmeat.sourceforge.net/projects/libv4l"
arch="all"
license="GPL-2.0"
depends="v4l-utils-libs eudev-libs argp-standalone"
makedepends="doxygen gettext graphviz alsa-lib-dev libtool jpeg-dev eudev-dev libx11-dev eudev-libs argp-standalone musl-dev"
subpackages="$pkgname-doc $pkgname-libs"
source="https://linuxtv.org/downloads/${_pkgname}/${_pkgname}-$pkgver.tar.bz2
	musl-workaround.patch"
builddir="${srcdir}/${_pkgname}-${pkgver}"
options="!check"

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share \
		--disable-v4l-utils \
		--disable-qv4l2 \
		LDFLAGS="-largp"
	make
}

package() {
	cd "$builddir"/utils/dvb
	make PREFIX="/usr" DESTDIR="$pkgdir" install
	
	cd "$builddir"/lib/libdvbv5
	make PREFIX="/usr" DESTDIR="$pkgdir" install
	
	mkdir -p "$pkgdir"/usr/share/man
	mv "$pkgdir"/usr/share/man1 "$pkgdir"/usr/share/man/man1

}

sha512sums="5c469479deb7065768e0254d1c80d9096caf05e445ceeabc7649f7158f02fb2d11ff2ad8c82debc1dbe6bbd7776cc5aa2febb52d5da0328d2b60b54af67c7a27  v4l-utils-1.14.2.tar.bz2
6d3c9455954108f7bb80ab4762fde9028f9ad88f7c5e2a8340ad42dc78703174543433c336fa5c1b1ba423bdd488d94785f20094cfe15768596945affc3f6f9a  musl-workaround.patch"

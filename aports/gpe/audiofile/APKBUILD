# Contributor: Duncan Guthrie <dguthrie@posteo.net>
# Maintainer: Duncan Guthrie <dguthrie@posteo.net>
pkgname=audiofile
pkgver=0.3.6
pkgrel=0
pkgdesc="Library for reading and writing audio files found in many common formats"
url="https://audiofile.68k.org/"
arch="all"
license="GPL-2.0-or-later LGPL-2.1-or-later BSD-3-Clause"
depends="libunwind flac"
makedepends="alsa-lib-dev linux-headers flac-dev"
source="${url}/${pkgname}-${pkgver}.tar.gz
	01_gcc6.patch
	02_hurd.patch
	03_CVE-2015-7747.patch
	04_clamp-index-values-to-fix-index-overflow-in-IMA.cpp.patch
	05_Always-check-the-number-of-coefficients.patch
	06_Check-for-multiplication-overflow-in-MSADPCM-decodeSam.patch
	07_Check-for-multiplication-overflow-in-sfconvert.patch
	08_Fix-signature-of-multiplyCheckOverflow.-It-returns-a-b.patch
	09_Actually-fail-when-error-occurs-in-parseFormat.patch
	10_Check-for-division-by-zero-in-BlockCodec-runPull.patch"
subpackages="${pkgname}-dev ${pkgname}-doc"
builddir="${srcdir}/${pkgname}-${pkgver}"
options="!check"

prepare() {
	default_prepare
	update_config_sub
}
build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}
package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="f9a1182d93e405c21eba79c5cc40962347bff13f1b3b732d9a396e3d1675297515188bd6eb43033aaa00e9bde74ff4628c1614462456529cabba464f03c1d5fa  audiofile-0.3.6.tar.gz
ae11735970eaddb664251614743cb46ae029b4073f4f8ea7cd4570d50c0f4b7f7b426399901b011d1ea799bb99d4ac648e76be97f13a51e32d7a63f97b38a89f  01_gcc6.patch
76ce5a29beaa394f3a24e7db7c40864f26119857e78087b6780853d06d4f44e80656c418b2c99d95224d29b69c23c51c54a4c8edac5dbaa4038a9d6c1ef7be06  02_hurd.patch
7673ab3fafdb0dac514a42622f53ea17aa56836c76413e5680c475537e195c53df21f26da1bd4e7941df2dc8b33a471ab52d539dabffbaef8bc95ee59951e7fe  03_CVE-2015-7747.patch
e7afe1a27566fb593ea53176256df23e447a2ee842cb4168930dec365fdabe7f2f43512d81bca5f14336ef0c756f6006c24948a3c2d79baafb0042ed8a145aae  04_clamp-index-values-to-fix-index-overflow-in-IMA.cpp.patch
187fb02a0d23390a62507756918c6f0b149570d7361bfe18944ea182adb966bb2bece93ed25eb6b38b61e252347cb68372c39ea948e094be7afea126d38115c0  05_Always-check-the-number-of-coefficients.patch
2a81cd1e87976b0123de0638fe4a20a644bc3292f938def3f1de205296f86c0dc7dfbb78a7c8d75c9b9e771c2dc96708f45d9766cf25be2a11bac61285e7de7f  06_Check-for-multiplication-overflow-in-MSADPCM-decodeSam.patch
65e46f7c7e5c994d98e15ed6e94b9512650cf30d4a7fb213f27a177e38defdb0575faa74712d2ef1c3541db069f98b10f7f365ebb01304a0bcdc92552114d701  07_Check-for-multiplication-overflow-in-sfconvert.patch
7c81e9dda0fc996a0c7a32da3f7480ddcb5cb30b1fd08c36d485021d699ab886732430271ac5a458c1d43dfb11fd0e97a4a9d7608c7f414eb23de59384b81a80  08_Fix-signature-of-multiplyCheckOverflow.-It-returns-a-b.patch
51c92ce66e987ae1d4bda65247134097705ef45cf7670401af7943bf6bbfc674089bcfafa49983046b10573ea72900adb96c296739c234d5e98539098eebe022  09_Actually-fail-when-error-occurs-in-parseFormat.patch
234b0b520eebccc8e7782735615ad8fb2f7c03937da2b7dec0b091ca35b8a542d4e5c7ad22ed6715f019cdb36992838d7458ef58980bfb4fa80062e764d18ae2  10_Check-for-division-by-zero-in-BlockCodec-runPull.patch"
